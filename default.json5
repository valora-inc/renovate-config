// default renovate config options for Valora repos
// for configs that are easy/possible to override (e.g. `mergeable` is false), use base.json5 instead. see README for details
{
  extends: ['github>valora-inc/renovate-config:base.json5'],

  // Dedupe dependencies
  postUpdateOptions: ['yarnDedupeFewer'],

  // The order of objects in the packageRules array does matter,
  // in the sense that rules declared later (towards the end of the array)
  // overwrite values of an also-matching rule declared earlier.
  packageRules: [
    // For now don't automerge major or minor updates for these network libraries,
    // since one of them broke recently, see https://github.com/axios/axios/issues/5296
    {
      matchUpdateTypes: ['major', 'minor'],
      automerge: false,
      matchPackageNames: ['axios', 'node-fetch'],
    },

    // Leave peerDependencies and engines alone
    {
      matchDepTypes: ['peerDependencies', 'engines'],
      enabled: false,
    },

    // Leave major @types/node updates alone
    // We only want to update these when we also update the node version
    {
      matchUpdateTypes: ['major'],
      matchPackageNames: ['@types/node'],
      enabled: false,
    },

    // Group devDependencies updates
    {
      matchDepTypes: ['devDependencies'],
      groupName: 'devDependencies',
      // Schedule this once a week since they can have frequent updates
      extends: ['schedule:earlyMondays'],
    },

    // Group test packages (jest, etc)
    {
      extends: ['packages:test'],
      groupName: 'test packages',
    },

    // Group linters (eslint, etc)
    {
      extends: ['packages:linters'],
      groupName: 'linters',
    },

    // Group updates for prettier packages
    {
      matchPackagePatterns: ['^prettier'],
      groupName: 'prettier packages',
    },

    // Group typescript packages
    {
      matchPackagePatterns: ['^typescript'],
      groupName: 'typescript packages',
    },

    // Group updates for @testing-library packages
    {
      matchPackagePatterns: ['^@testing-library/'],
      groupName: 'testing-library packages',
    },

    // Group updates for @segment packages
    {
      matchPackagePatterns: ['^@segment/'],
      groupName: 'segment packages',
    },

    // Group updates for @celo packages
    {
      matchPackagePatterns: ['^@celo/'],
      groupName: 'celo packages',
    },

    // Group updates for @fiatconnect packages
    {
      matchPackagePatterns: ['^@fiatconnect/'],
      groupName: 'fiatconnect packages',
      // No risk of unpublishing and these are typically pulled in immediately
      stabilityDays: 0,
    },

    // Disable stability days for some packages, where we don't expect unpublishing
    // so they are pulled in immediately
    {
      matchPackagePatterns: ['^@valora/'],
      matchPackageNames: ['renovate'],
      stabilityDays: 0,
    },
  ],
}
